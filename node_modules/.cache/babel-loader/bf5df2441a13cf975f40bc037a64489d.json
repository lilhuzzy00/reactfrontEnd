{"ast":null,"code":"import _objectSpread from\"C:/Users/GOD'SPOWER/Desktop/reactfrontEnd/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"C:/Users/GOD'SPOWER/Desktop/reactfrontEnd/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import{Link,Redirect}from\"react-router-dom\";import{braintreeClientToken,processPayment,createOrder}from\"./ApiCore\";import{emptyCart}from\"./CartHelper\";import Card from\"./Card\";import{isAuthenticated}from\"../auth\";import DropIn from\"braintree-web-drop-in-react\";import\"./Checkout.css\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Checkout=function Checkout(_ref){var products=_ref.products;var _useState=useState({success:false,loading:false,error:\"\",clientToken:null,instance:{},address:\"\"}),_useState2=_slicedToArray(_useState,2),data=_useState2[0],setData=_useState2[1];var userId=isAuthenticated()&&isAuthenticated().user._id;var token=isAuthenticated()&&isAuthenticated().token;var getToken=function getToken(userId,token){braintreeClientToken(userId,token).then(function(data){if(data.error){setData(_objectSpread(_objectSpread({},data),{},{error:data.error}));}else{setData({clientToken:data.clientToken});}});};useEffect(function(){getToken(userId,token);},[]);var handleAddress=function handleAddress(event){setData(_objectSpread(_objectSpread({},data),{},{address:event.target.value}));};var getTotal=function getTotal(){return products.reduce(function(currentValue,nextValue){return currentValue+nextValue.count*nextValue.price;},0);};var showCheckout=function showCheckout(){return isAuthenticated()?/*#__PURE__*/_jsx(\"div\",{children:showDropIn()}):/*#__PURE__*/_jsx(Link,{to:\"/signin\",children:\"Signin\"});};var deliveryAddress=data.address;var buy=function buy(){setData({loading:true});// Send nonce to your server\n//nonce = data.instance.requestPaymentMethod()\nvar nonce;var getNonce=data.instance.requestPaymentMethod().then(function(data){// console.log(data)\nnonce=data.nonce;// once you have nonce (card type, card number), send nonce as paymentMethodNonce to the backend\n// Also send total to be charged\n// console.log(\n// \t\"send nonce and total to process\", \n// \tnonce, \n// \tgetTotal(products)\n// )\nvar paymentData={paymentMethodNonce:nonce,amount:getTotal(products)};processPayment(userId,token,paymentData).then(function(response){console.log(response);var createOrderData={products:products,transaction_id:response.transaction.id,amount:response.transaction.amount,address:deliveryAddress};createOrder(userId,token,createOrderData).then(function(response){//Empty Cart\nemptyCart(function(){console.log(\"Payment success and empty cart\");setData({loading:false,success:true});});});}).catch(function(error){setData({loading:false});});}).catch(function(error){console.log(\"dropIn error\",error);setData(_objectSpread(_objectSpread({},data),{},{error:error.message}));});};var showError=function showError(error){return/*#__PURE__*/_jsx(\"div\",{className:\"alert alert-danger\",style:{display:error?\"\":\"none\"},children:error});};var showSuccess=function showSuccess(success){return/*#__PURE__*/_jsx(\"div\",{className:\"alert alert-info\",style:{display:success?\"\":\"none\"},children:\"Thank you! Your Payment was successful\"});};var showLoading=function showLoading(loading){return loading&&/*#__PURE__*/_jsx(\"div\",{className:\"alert alert-info\",children:\"Loading...\"});};var showDropIn=function showDropIn(){return/*#__PURE__*/_jsx(\"div\",{className:\"firstshowDropIn\",onBlur:function onBlur(){return setData(_objectSpread(_objectSpread({},data),{},{error:\"\"}));},children:data.clientToken!==null&&products.length>0?/*#__PURE__*/_jsxs(\"div\",{className:\"showDropIn\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group mb-3\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-muted\",children:\"Delivery Address:\"}),/*#__PURE__*/_jsx(\"textarea\",{className:\"form-control textArea\",onChange:handleAddress,value:data.address,placeholder:\"Please Enter Your Address\",style:{width:\"700px\"}})]}),/*#__PURE__*/_jsx(DropIn,{options:{authorization:data.clientToken,paypal:{flow:\"vault\"}},onInstance:function onInstance(instance){return data.instance=instance;}}),/*#__PURE__*/_jsx(\"button\",{onClick:buy,style:{width:\"150px\",marginBottom:\"10px\"},className:\"btn btn-success btn-block\",children:\"Pay\"})]}):null});};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"h3\",{style:{color:\"black\"},children:[\"Total: \\u20A6\",getTotal()]})}),showLoading(data.loading),showSuccess(data.success),showError(data.error),showCheckout()]});};export default Checkout;","map":{"version":3,"sources":["C:/Users/GOD'SPOWER/Desktop/reactfrontEnd/src/core/Checkout.js"],"names":["React","useState","useEffect","Link","Redirect","braintreeClientToken","processPayment","createOrder","emptyCart","Card","isAuthenticated","DropIn","Checkout","products","success","loading","error","clientToken","instance","address","data","setData","userId","user","_id","token","getToken","then","handleAddress","event","target","value","getTotal","reduce","currentValue","nextValue","count","price","showCheckout","showDropIn","deliveryAddress","buy","nonce","getNonce","requestPaymentMethod","paymentData","paymentMethodNonce","amount","response","console","log","createOrderData","transaction_id","transaction","id","catch","message","showError","display","showSuccess","showLoading","length","width","authorization","paypal","flow","marginBottom","color"],"mappings":"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","sourcesContent":["import React, {useState, useEffect} from \"react\";\r\nimport {Link, Redirect} from \"react-router-dom\";\r\nimport { braintreeClientToken, processPayment, createOrder } from \"./ApiCore\";\r\nimport {emptyCart} from \"./CartHelper\";\r\nimport Card from \"./Card\";\r\nimport { isAuthenticated } from \"../auth\" ;\r\nimport DropIn from \"braintree-web-drop-in-react\";\r\nimport \"./Checkout.css\";\r\n\r\n\r\nconst Checkout = ({ products }) => {\r\n\r\n\tconst [data, setData] = useState({\r\n\t\tsuccess: false,\r\n\t\tloading: false,\r\n\t\terror: \"\",\r\n\t\tclientToken: null,\r\n\t\tinstance: {},\r\n\t\taddress: \"\"\r\n\t})\r\n\r\nconst userId = isAuthenticated() && isAuthenticated().user._id;\r\nconst token = isAuthenticated() && isAuthenticated().token;\r\n\r\nconst getToken = (userId, token) => {\r\n\tbraintreeClientToken(userId, token)\r\n\t\t.then(data => {\r\n\t\t\tif(data.error){\r\n\t\t\t\tsetData({...data, error: data.error})\r\n\t\t\t} else {\r\n\t\t\t\tsetData({clientToken: data.clientToken})\r\n\t\t\t}\r\n\t\t})\r\n}\r\n\r\nuseEffect(()=>{\r\n\tgetToken(userId, token);\r\n}, [])\r\n\r\nconst handleAddress = (event) => {\r\n\tsetData({...data, address: event.target.value})\r\n}\r\n\r\n\t\r\nconst getTotal = () => {\r\n\treturn products.reduce((currentValue, nextValue)=>{\r\n\t\treturn currentValue + nextValue.count * nextValue.price\r\n\t}, 0)\r\n}\r\n\r\nconst showCheckout = () =>(\r\n\tisAuthenticated() ? <div>{showDropIn()}</div> : <Link to=\"/signin\">Signin</Link>\r\n)\r\n\r\nlet deliveryAddress = data.address;\r\n\r\nconst buy = () => {\r\n\tsetData({loading: true});\r\n\t// Send nonce to your server\r\n\t//nonce = data.instance.requestPaymentMethod()\r\n\r\n\tlet nonce;\r\n\tvar getNonce = data.instance.requestPaymentMethod()\r\n\t\t.then(data =>{\r\n\t\t\t// console.log(data)\r\n\t\t\tnonce = data.nonce\r\n\t\t\t// once you have nonce (card type, card number), send nonce as paymentMethodNonce to the backend\r\n\t\t\t// Also send total to be charged\r\n\t\t\t// console.log(\r\n\t\t\t// \t\"send nonce and total to process\", \r\n\t\t\t// \tnonce, \r\n\t\t\t// \tgetTotal(products)\r\n\t\t\t// )\r\n\r\n\t\t\tconst paymentData = {\r\n\t\t\t\tpaymentMethodNonce: nonce,\r\n\t\t\t\tamount: getTotal(products)\r\n\t\t\t}\r\n\t\t\tprocessPayment(userId, token, paymentData)\r\n\t\t\t\t.then(response => {\r\n\t\t\t\t\tconsole.log(response);\r\n\r\n\t\t\t\t\tconst createOrderData = {\r\n\t\t\t\t\t\tproducts: products,\r\n\t\t\t\t\t\ttransaction_id: response.transaction.id,\r\n\t\t\t\t\t\tamount: response.transaction.amount,\r\n\t\t\t\t\t\taddress: deliveryAddress\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tcreateOrder(userId, token, createOrderData)\r\n\t\t\t\t\t\t.then(response => {\r\n\r\n\t\t\t\t\t\t\t//Empty Cart\r\n\r\n\t\t\t\t\t\t\temptyCart(()=>{\r\n\t\t\t\t\t\t\t\tconsole.log(\"Payment success and empty cart\")\r\n\t\t\t\t\t\t\t\tsetData({loading: false, success: true});\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\r\n\t\t\t\t})\r\n\t\t\t\t.catch((error) => {\r\n\t\t\t\t\tsetData({loading: false});\r\n\t\t\t\t})\r\n\r\n\t\t})\r\n\t\t.catch(error => {\r\n\t\t\tconsole.log(\"dropIn error\", error)\r\n\t\t\tsetData({...data, error: error.message})\r\n\t\t})\r\n}\r\n\r\nconst showError = (error) => (\r\n\t<div className=\"alert alert-danger\" style={{display: error ? \"\" : \"none\"}}>{error}</div>\r\n)\r\n\r\nconst showSuccess = (success) => (\r\n\t<div \r\n\t\tclassName=\"alert alert-info\" \r\n\t\tstyle={{display: success ? \"\" : \"none\"}}\r\n\t>\r\n\t\tThank you! Your Payment was successful\r\n\t</div>\r\n)\r\n\r\nconst showLoading = (loading) =>(\r\n\tloading && (\r\n\t\t<div className=\"alert alert-info\">Loading...</div>\r\n\t)\r\n)\r\n\r\nconst showDropIn = () => (\r\n\t\t<div className=\"firstshowDropIn\" onBlur={()=> setData({...data, error: \"\"})}>\r\n\t\t\t{data.clientToken !== null && products.length > 0 ? (\r\n\t\t\t\t<div className=\"showDropIn\">\r\n\t\t\t\t\t<div className=\"form-group mb-3\">\r\n\t\t\t\t\t\t<label className=\"text-muted\">Delivery Address:</label>\r\n\t\t\t\t\t\t<textarea className=\"form-control textArea\" \r\n\t\t\t\t\t\t\tonChange={handleAddress} \r\n\t\t\t\t\t\t\tvalue={data.address}\r\n\t\t\t\t\t\t\tplaceholder=\"Please Enter Your Address\" \r\n\t\t\t\t\t\t\tstyle={{width: \"700px\"}}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t\r\n\t\t\t\t\t\t<DropIn \r\n\t\t\t\t\t\t\toptions={{\r\n\t\t\t\t\t\t\t\tauthorization: data.clientToken,\r\n\t\t\t\t\t\t\t\tpaypal: {\r\n\t\t\t\t\t\t\t\t\tflow: \"vault\"\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\tonInstance={(instance) => (data.instance = instance)}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t<button onClick={buy} style={{width: \"150px\", marginBottom: \"10px\"}} className=\"btn btn-success btn-block\">Pay</button>\r\n\t\t\t\t</div>\r\n\t\t\t) : null }\r\n\t\t</div>\r\n)\r\n\r\n\treturn (\r\n\t\t<div>\r\n\t\t\t<div><h3 style={{color: \"black\"}}>Total: ₦{getTotal()}</h3></div>\r\n\t\t\t{showLoading(data.loading)}\r\n\t\t\t{showSuccess(data.success)}\r\n\t\t\t{showError(data.error)}\r\n\t\t\t{showCheckout()}\r\n\t\t</div>\r\n\t)\r\n}\r\n\r\n\r\nexport default Checkout;"]},"metadata":{},"sourceType":"module"}